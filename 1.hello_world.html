<!DOCTYPE html>
<html>

<head>
  <title>Hello World. VIPER ROSJS</title>
  <meta charset="utf-8" />
  <script src="3rdparty/eventemitter2.js"></script>
  <script src="3rdparty/roslib.js"></script>
  <script src="3rdparty/base64-binary.js"></script>
  <!-- <script src="cvm_api.js" type="text/javascript"></script> -->
  <script src="viper.js" type="text/javascript"></script>
    <script>
		var viper = null;
		function onload() {
			viper = new VIPER({viper_ip : "192.168.1.170"});
			viper.log = myLog;
			viper.onConnected = onConnected;
			viper.connect();
			
			viper.log('Hello world!');
		}
		function onConnected() {
			viper.log('Is connected: ', viper.connected);
			viper.log('VIPER version is ', viper.version);
			viper.log('Namespace: ', viper.deviceInfo.get("VIPER_PREFIX"));
			viper.log('');
			viper.log('Applications:');
			for (var i = 0; i < viper.apps.length; i++)
				viper.log('&nbsp; "', viper.apps[i].name, '", Is active: ', viper.apps[i].isActive);
			viper.log('');
			viper.log('Published topics:');
			for (var i = 0; i < viper.topics.length; i++)
				viper.log('&nbsp; ', viper.topics[i]);
		}
		
		function finalize() {
			viper.close();
		}
		
		/** Overriding default logging function with the one that ouputs log directly to page.
		 */
		function myLog(m1, m2, m3, m4, m5, m6, m7, m8, m9, m10) {
			var myConsole = document.getElementById('myConsole');
			var t = new Date();
			var line = '<div>[' + t.getHours() + ':' + t.getMinutes() + ':' + t.getSeconds() + ' Viper]: ' 
				+ (m1 == null? "":m1)
				+ (m2 == null? "":m2)
				+ (m3 == null? "":m3)
				+ (m4 == null? "":m4)
				+ (m5 == null? "":m5)
				+ (m6 == null? "":m6)
				+ (m7 == null? "":m7)
				+ (m8 == null? "":m8)
				+ (m9 == null? "":m9)
				+ (m10 == null? "":m10) + '</div>';
			myConsole.insertAdjacentHTML('beforeend', line);
		}
	</script>
</head>
<body style="background: lightgray; cover;font-family:Arial;" onload="onload();" onunload="finalize()">
</body>
	<div id="myConsole"></div>
</html>